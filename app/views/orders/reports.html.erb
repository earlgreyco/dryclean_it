<% content_for :dashboard_content do %>
	<script>
		$(function(){
			new Highcharts.Chart({
				chart: {
					renderTo: "orders_chart"
				},
				title: {
					text: "Orders by Day"
				},
				xAxis: {
					type: "datetime"
				},
				yAxis: {
					title: {
						text: "Dollars"
					}
				},
				tooltip: {
					formatter: function(){
						return Highcharts.dateFormat("%B %e, %Y", this.x) + ': '+ "$" + Highcharts.numberFormat(this.y, 2);
					}
				},
				series: [
				{
					name: "Total Revenue",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= Order.first.created_at.to_i * 1000 %>,
					data:  <%= (Order.first.created_at.to_date..Date.today).map { |date| Order.total_with_credits(date).to_f}.inspect %>
				},
				<% {"Cash" => Order.cash, "Card" => Order.card, "Check" => Order.check}.each do |name, orders| %>

				{
					name: "<%= name %>",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= Order.first.created_at.to_i * 1000 %>,
					data: <%= (Order.first.created_at.to_date..Date.today).map { |date| orders.total_on(date).to_f }.inspect %>
				},
				<% end %>
				{
					name: "Credits",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= Order.first.created_at.to_i * 1000 %>,
					data:  <%= (Order.first.created_at.to_date..Date.today).map { |date| Order.total_credits_used(date).to_f}.inspect %>
 				}]
			});

			new Highcharts.Chart({
				chart: {
					renderTo: "customers_chart"
				},
				title: {
					text: "New Customers by Day"
				},
				xAxis: {
					type: "datetime"
				},
				yAxis: {
					title: {
						text: "# New Customers"
					}
				},
				tooltip: {
					formatter: function(){
						return Highcharts.dateFormat("%B %e, %Y", this.x) + ': ' + Highcharts.numberFormat(this.y, 2) + ' customers';
					}
				},
				series: [
				{
					name: "# New Customers",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= Order.first.created_at.to_i * 1000 %>,
					data:  <%= (Order.first.created_at.to_date..Date.today).map { |date| Customer.total_on(date)}.inspect %>
				}]
			});

			new Highcharts.Chart({
				chart: {
					renderTo: "articles_chart"
				},
				title: {
					text: "New Articles by Day"
				},
				xAxis: {
					type: "datetime"
				},
				yAxis: {
					title: {
						text: "# New Articles"
					}
				},
				tooltip: {
					formatter: function(){
						return Highcharts.dateFormat("%B %e, %Y", this.x) + ': ' + Highcharts.numberFormat(this.y, 2) + ' articles';
					}
				},
				series: [
				<% {"Total Articles" => OrderItem, "Dryclean" => OrderItem.dryclean, "Launder" => OrderItem.launder, "Other" => OrderItem.other}.each do |name, order_items| %>

				{
					name: "<%= name %>",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= Order.first.created_at.to_i * 1000 %>,
					data: <%= (Order.first.created_at.to_date..Date.today).map { |date| order_items.total_on(date).to_f }.inspect %>
				},
				<% end %>
				]
			});
		});
	</script>

	<div id="orders_chart" style="width:100%; height: 400px; border: 1px solid #e5e5e5;"></div>

	<div id="customers_chart" style="width:100%; height: 400px; margin-top: 20px; border: 1px solid #e5e5e5;"></div>

	<div id="articles_chart" style="width:100%; height: 400px; margin-top: 20px; border: 1px solid #e5e5e5;"></div>
<% end %>
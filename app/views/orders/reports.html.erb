<% content_for :dashboard_content do %>
	<script>
		$(function(){
			new Highcharts.Chart({
				chart: {
					renderTo: "orders_chart"
				},
				title: {
					text: "Orders by Day"
				},
				xAxis: {
					type: "datetime"
				},
				yAxis: {
					title: {
						text: "Dollars"
					}
				},
				tooltip: {
					formatter: function(){
						return Highcharts.dateFormat("%B %e, %Y", this.x) + ': '+ "$" + Highcharts.numberFormat(this.y, 2);
					}
				},
				series: [
				<% {"Total Without Credits" => Order, "Cash" => Order.cash, "Card" => Order.card, "Check" => Order.check}.each do |name, orders| %>

				{
					name: "<%= name %>",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= 3.weeks.ago.to_i * 1000 %>,
					data: <%= (3.weeks.ago.to_date..Date.today).map { |date| orders.total_on(date).to_f }.inspect %>
				},
				<% end %>
				{
					name: "Total Revenue",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= 3.weeks.ago.to_i * 1000 %>,
					data:  <%= (3.weeks.ago.to_date..Date.today).map { |date| Order.total_with_credits(date).to_f}.inspect %>
				}, {
					name: "Credits Used",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= 3.weeks.ago.to_i * 1000 %>,
					data:  <%= (3.weeks.ago.to_date..Date.today).map { |date| Order.total_credits_used(date).to_f}.inspect %>
 				}]
			});

			new Highcharts.Chart({
				chart: {
					renderTo: "customers_chart"
				},
				title: {
					text: "New Customers by Day"
				},
				xAxis: {
					type: "datetime"
				},
				yAxis: {
					title: {
						text: "# New Customers"
					}
				},
				tooltip: {
					formatter: function(){
						return Highcharts.dateFormat("%B %e, %Y", this.x) + ': ' + Highcharts.numberFormat(this.y, 2) + ' customers';
					}
				},
				series: [
				{
					name: "# New Customers",
					pointInterval: <%= 1.day * 1000 %>,
					pointStart: <%= 3.weeks.ago.to_i * 1000 %>,
					data:  <%= (3.weeks.ago.to_date..Date.today).map { |date| Customer.total_on(date)}.inspect %>
				}]
			});
		});
	</script>

	<div id="orders_chart" style="width:100%; height: 400px; margin-top: 20px; border: 1px solid #e5e5e5;"></div>

	<div id="customers_chart" style="width:100%; height: 400px; margin-top: 20px; border: 1px solid #e5e5e5;"></div>
<% end %>
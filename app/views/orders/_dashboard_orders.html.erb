<div id="order-container" class="basic-container">
	<% if current_user.orders.any? %>
		<% @dates = [] %>
		<% current_user.orders.each do |order| %>
			<% @dates << order.created_at.to_date %>
		<% end %>
		<% @oldest_order = @dates.min %>

		<% Date.today.downto(@dates.min) do |date| %>
			<% date = date - 0.days %>
			<% @orders_by_date = Order.where(["created_at >= ? AND created_at <= ?", date.beginning_of_day, date.end_of_day]) %>

			<table class="order-history-table">
				<tr>
					<th colspan="7">
						<span class="pull-left order-date">
							<%= date.in_time_zone("Pacific Time (US & Canada)").strftime("%A") %>
						</span>
						<span class="pull-right order-date">
							<%= date.in_time_zone("Pacific Time (US & Canada)").strftime("%D") %>
						</span>
					</th>
				</tr>
				<tr>
					<th>#</th>
					<th>Customer</th>
					<th>Rack</th>
					<th>Tag</th>
					<th>Credits Used</th>
					<th>Total Price</th>
					<th>Pickup Date</th>
				</tr>
				<% @orders_by_date.recent_ones_first.each do |order| %>
				<tr>
					<td>
						<%= order.id %>
					</td>
					<td style="text-align: left;">
						<%= filepicker_image_tag order.customer_img, w:50, h:50, fit:'crop' %>
						<%= order.customer_first_name %> 
						<%= order.customer_last_name %>
					</td>
					<td>
						<!-- rack number -->
					</td>
					<td>
						<%= best_in_place order, :tag_number %>
					</td>
					<td>
						<%= best_in_place order, :credits_used %>
					</td>
					<td>
						<%= best_in_place order, :total_price %>
					</td>
					<td class="pickup-<%= order.id %>" style="min-width: 165px;">
						<% if order.picked_up == true %>
							<%= order.pickup_date.in_time_zone("Pacific Time (US & Canada)").strftime("%D") %><br>
							<%= order.pickup_date.in_time_zone("Pacific Time (US & Canada)").strftime("%I:%M%p") %>
						<% else %>
							<div class="estimated-date">
								<%= order.pickup_date.in_time_zone("Pacific Time (US & Canada)").strftime("%D") %>
							</div>
							<div class="pickup-button">
								<%= link_to "Picked Up", save_pickup_date_order_path(order), class: "orange-button pickup-button-action", remote: true %>
							</div>
						<% end %>
					</td>
				</tr>
				<% end %>
			</table>
		<% end %>
	<% end %>
</div>